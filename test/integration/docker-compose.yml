version: '2'

# TODO: use variables for database

services:
    mysql:
        image: mysql:5.7
        tmpfs: /var/lib/mysql:rw
        volumes:
            - ./fixtures:/docker-entrypoint-initdb.d
        ports:
            - '3306'
        environment:
            MYSQL_ALLOW_EMPTY_PASSWORD: 'yes'
            MYSQL_DATABASE: flora_mysql_testdb
    test:
        image: node:6-alpine
        volumes:
            - ../../:/usr/src/app
        working_dir: /usr/src/app
        environment:
            - NODE_ENV=development
        depends_on:
            - mysql
        command: ['test/integration/wait-for-mysql.sh', 'mysql', './node_modules/.bin/grunt', 'test-integration']
